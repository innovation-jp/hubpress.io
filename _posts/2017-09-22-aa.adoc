# Laradockを使ってDockerでLaravelの環境構築をし、GCPにイメージをおいたお話。
:hp-alt-title: aa
:hp-tags: kohe,Docker,Laradock,GCP


皆様こんばんは。こへです。
そろそろ寒くなって来ており、 +
*Laradockを使ってDockerでLaravelの環境構築をし、GCPにimageをおきたい* +
時期が来ましたので、やってみました。


※まずDockerが入ってない人は +
https://docs.docker.com/docker-for-mac/install/#download-docker-for-mac +
からdownload。私は*Stable* の方をdownloadしました。


## Laradoc編

巷の噂でLaravelの環境構築はLaradockを使うと楽と言う噂を聞いた気がするので使ってみます。 +

※あとDockerを使いたかったてのもあります。


適当なディレクトリを作り + 
`git clone https://github.com/LaraDock/laradock.git` +
そして、laradockに移動 +
`cd laradock` +
そして、docker-compose 用にenvファイルをコピー +
`cp env-example .env`





## GCP準備編

まずは、Google Cloud Platform のプロダクトとサービスのためのコマンドライン インターフェースをインストール。

https://cloud.google.com/sdk/

↑から必要な圧縮ファイルをDLする

`python -V` で `Python 2.7.0` 以上が入っているかチェック +

あとは `gcloud init`　でプロジェクトを選んだりして設定。

セッティングが終わったら

`gcloud　confg list`　で　自分が選んだプロジェクトが選択されているか確認。

上手くいかなかったりしたら `gcloud init`　で設定を何回でもやり直せるから安心。

## Docker＆GCP編

`docker image ls`でGCPにぶち込みたいimageをチェック

今回のターゲットはコヤツ↓

[options="header"]
|=======================
|REPOSITORY  |TAG      | IMAGE ID | CREATED   | SIZE
|laradock_nginx    |latest    |a028b33b0cf3  |      5 days ago      |    20MB
|=======================


*laradock_nginx*　にGCPにぶち込むようのTAGを付けていく。


`docker tag laradock_nginx gcr.io/xxxxxxxxxxxxx/kohe_nginx`

フォーマットはこんな感じ　[underline]#_[HOSTNAME]/[YOUR-PROJECT-ID]/[IMAGE]_#


そしたら `docker image ls`でもっかい確認


[options="header"]
|=======================
|REPOSITORY  |TAG      | IMAGE ID | CREATED   | SIZE
|laradock_nginx    |latest    |a028b33b0cf3  |      5 days ago      |    20MB　
| gcr.io/xxxxxxxxxxxxx/kohe_nginx|  latest    |a028b33b0cf3  |      5 days ago      |    20MB
|=======================


いい感じ。

あとは　`gcloud docker -- push gcr.io/xxxxxxxxxxxxxxxx/kohe_nginx` +
で行ける！！ +
と思いきや　*Error…* 

_Error response from daemon: login attempt to https://appengine.gcr.io/v2/ failed with status: 404 Not Found_

うんうん、なるほどね、とりまググる。

チェックを外す。

image::/images/kohe/docker_gcp_1.png[]

```
8cccea641d3e: Pushed
0e5158e5f8e2: Pushed
1c0bd62a9ea6: Pushed
717d526872c2: Pushed
7989087b5764: Pushed
4ea319796454: Pushed
2ad4411074c9: Pushed
040fd7841192: Layer already exists

```

お、うまくいってそう。

GCPを確認…

お、来てる！

image::/images/kohe/docker_gcp2.png[]


`gcloud docker -- pull gcr.io/xxxxxxxxxxxxxxxxxx/kohe_nginx`  +
後は↑でpull　すればおっけー。


