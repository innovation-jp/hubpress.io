= Laravel勉強会を開催しました
:published_at: 2016-12-22
:hp-alt-title: Larastudy
:hp-tags: Laravel
:hp-image: larastudy1.png

こんばんは、皆様Advent Calendarに追われる日々をいかがお過ごしでしょうか？
歳末大感謝モードでお送りします塚本です。
表題の通り、イベントレポートです。

## 実施概要
去る12月19日、弊社セミナールームにて社外講師を招いての技術勉強会を行いました。
題材は Laravelフレームワークについて

image::larastudy1.jpg[ビアバッシュ形式]


### Laravelとは

近年最もシェアを伸ばしているPHPフレームワークです。
以前のブログでも何度か触れていますが、弊社サービスの一つはLaravel5.2へ移行しました。

http://tech.innovation.co.jp/2016/08/12/Why-Using-Framework.html[なぜフレームワークを使うのか]に書きましたが、フレームワークの選定は思想に則ることで恩恵を受けやすいわけです。
ところがLaravelは当初自分たちが想定していたより自由度が高く、また作者のOtwell氏も公式ドキュメントには最低限の説明しか載せていないため、どこからどこまでが原則的なものが掴めないまま進んでいました。

実際にコーディングしているメンバーも、そのあたりに対する迷いからくる不安が払拭されないまま負債を増やしていくことへなんとかしたい思いが芽生えていました。

そしてひょんなことから
草創期からLaravelに関わり深い造詣のある竹澤さん（ https://twitter.com/ex_takezawa[@ex_takezawa] ）
栗生さん（ https://twitter.com/k_kuriu[@k_kuriu]）の
お二人をお招きして社内で勉強会を開きました。

image::larastudy2.jpg[左から栗生さん 竹澤さん]

## 事前準備

チーム内に課題感があるのは承知していましたが、じゃあ具体的にどこからどうみたいな絵図はなく、軽い気持ちでざっくりオファーを出したところ、お二人とも快く受けてくださりました。
しかしそもそも若手が多い弊社開発組織ですので、Laravelがどうとか以前にフレームワーク自体を他にまともには触っていなかったり。
つまり、MVCパターンとはなんぞ？ ActiveRecordパターン、DIパターンの目的？など、最近のフレームワークの主流となっている基礎的なパターンを参加者全員が学んでおく必要がありました。

そもそもオブジェクト指向プログラミングの基本が抜けていたりしたため、リフレクションもやるべきだった。

プロセスとして

「学びたい！」というニーズがあるから
↓↓↓↓
きてもらう

では何もかも足りないわけです。
- 本当に「学びたい」と思っているか
- 課題として捉えていることはチームの課題か個人の課題か
このあたりの炙り出し作業が大事でした。

IMPORTANT: 軽い気持ちでお願いしてはいけない


## 勉強会テーマ
前置きが長くなりましたが、ざっくり以下のようなテーマ設定で臨みました

- Laravelを使う上で守るべき原則
- Laravelを使う上でのアンチパターン
- 状況によって使い分けするもの
- 個別に聞きたいこと

ちなみにバージョンは > 5.1 を前提としています
（リファレンス本がそう）

https://speakerdeck.com/hihats/larastudy2016[スライド]（AsciidocはJSで埋め込めない？）

====

<script async class="speakerdeck-embed" data-id="53d4e7d55e774ccba6f57d4156107c5a" data-ratio="1.77777777777778" src="//speakerdeck.com/assets/embed.js"></script>
====


## スライド補足

### 原則について

DIコンテナを使うというか、Laravelそのものなので使うのは当たり前ですが、
なるべくサービスコンテナ（DIコンテナ）に
*コンストラクタのタイプヒント解析と依存性の注入の再帰的実行を任せる* という意味

あとは、カーネルのソースコード読もう！

MVCについて語る前に、モデリングについて再確認しましょう（結局設計）


### アンチパターンについて

- Facadeは推奨しないが、アンチパターンというほどではなく使って良いケースも有る
  （Viewの中で呼ぶためだけなら良いんじゃないか）

  ただし

IMPORTANT: ファサードをマネてstaicのクラスを作るのはやめましょう


  また、全てのContractをDIにすればよいわけではなく、罠もある

- 使わないMiddlewareをはずしましょう
   デフォルトではすべてのMiddlewareを通ってしまう
   APIにセッションいらないよね？


### Facade警察
竹澤さんの別名

### Eloquent
本家ActiveRecordと同じように、Entityとレコードを対応させる機能が発展したことで、MySQLのオプティマイザを飛び越えるクエリが走るようになった。
（会では言及されなかったけど）N+1問題もある

手軽にとってくるだけなら便利は便利（使い分けもあり）

というわけで、そこそこの規模になると使わなくなる


### テスト可能性
結局テストできないとツライ


とこんな感じで盛り沢山になりましたが、一様に疑問点に対しての納得感は高く、しっかり着地できて一安心でした。


## メンバーの感想

### 率直に

− もっと本質的な知識(MVCやオブジェクト指向、DI等)を抑えないと、フレームワークの適切な使い方を判断するのが、難しいと思った。
− 次に着手する事が明確になった点がとても良かったです。
− 後半難しかった（多し）
− 設計思想についての話に寄っていたと思いますが個人的には楽しかった
− 事前に説明されていたDIなどがイメージとして理解できた

### 聞けてよかった具体箇所

− 各パターンの話
− 守破離の話
− 便利なものが正義なわけではない(Facadeの話より：値がほしいだけでFacadeされるオブジェクトが必要なわけではない)

### 難しかった箇所

− サービスロケータとDIコンテナの違い
− ドメイン駆動設計の話
 
## まとめ
粗いテーマ設定にもかかわらず、次から次へと溢れ出る[line-through]#思い#言葉によって、参加者を巻き込んでいただき講師のお二人には大変感謝です。
計らずも、竹澤さん登場まで栗生さんのピコ太郎つなぎでいい感じに暖まりました。

image::larastudy3.jpg[piko]

噛み砕いていくと、Laravelどうこうではなく、オブジェクト指向プログラミングの理解、ソースコードの循環的複雑度、疎結合にする、多重責務にしない 
といった本当に基礎の部分が足りていないことに気づくわけですが、Webアプリケーションの仕事だけだとそこが抜けていても成立してしまうケースが多いのが事実としてあります。
若手にとっては早い段階でこういった気付きに出会えてよかったと思います。
本当にお二人には重ねて感謝申し上げます。

次回はAOPがテーマです。飛び級すぎだろというマサカリは既に刺さっております。

こちらからは以上です。