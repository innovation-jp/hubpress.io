= はじめてのデータサイエンス（Exploratoryで品目別国別輸出統計の分析）
:published_at: 2017-06-30
:hp-alt-title: First work of my data sience
:hp-tags: dataScience, Exploratory, e-stat

どうもbigenです。

先日、link:https://exploratory.io/[Exploratory]が主催するlink:https://exploratory.io/training-jp[データサイエンスブートキャンプ]に参加してきました。 +
休日コース４日間のうち、２日間消化して、色々なことを学んできたので、忘れないうちにいったんアウトプットしてみました。 +
僕のはじめてのデータサイエンス、というわけです。 +
 +
なにはともあれ、今回得られたものはこちらです。 +
 +

image::bigen/exploratory1.gif[]

== 感想
それっぽいグラフが出せました。 +
 +
 
* 輸出全体で見ると3月が多くなっていある。動物・食品の業界でも期末需要とかあるのかな？
* 地域別でみると当たり前だけどアジアが多い。
* 国の内訳を見てみると、中国とかやっぱ多い。あとアジア多すぎて他の地域のグラフがつぶれてしまった。
* 地域ごとに内訳を見てみると、「この国、この月しか輸出してなくね？」みたいなのがあって、文化的なバックグラウンドとかあるのかなとか思いました。お祭りとか。


みたいな感じで、まだぼやっとしたことしか分からず、深く分析まではしていません。 +
今回は、実際に取得できるデータから、分析可能な状態に加工してグラフを出力するところまでを目標にしていたので、 そこそこ良い感じのモノを出せて満足でした。 +
 +
というわけで、以下では実際にこのグラフを出力するまでにやったことを説明していきます。 +
 +
これがもう大変でした、本当に。データサイエンティストってすごい。

== 前提

#### Exploratory
今回使う分析ツールは、Exploratoryというツールです。 +
今風なUIで、簡単に強力な分析ができるスグレモノで、 機械学習も色々できます。 +
 +
実はまさに今日、回帰・決定木・XGBoosting・クラスタリング・時系列解析などのやり方も教わってきたのですが、 +
それらは次回ご紹介したいと思います。 +

#### e-stat
分析に使ったデータの出典はlink:https://www.e-stat.go.jp/[e-Stat]からです。 +
政府が公表している各種統計データの保管サイトで、複製・変形が基本OKな良いところです。 +
 +
 ちなみに今回使ったデータは、 +
 
① link:http://www.e-stat.go.jp/SG1/estat/List.do?lid=000001171307[輸出に関する品別国別統計表2016年12月分第一部] +
② link:http://www.customs.go.jp/yusyutu/2016/index.htm[輸出統計品目表（2016年版）第一類〜第五類] +
③ link:http://www.customs.go.jp/toukei/sankou/dgorder/a1.htm[統計国名符号表] +

です。 +
 +
 つまり、「2016年に日本がどの国に何をどのくらい輸出したか」っていうデータです。（今回は動物及び動物性生産品に限る）
 
== データの加工
#### とりあえずメインのデータを取り込んでみる
とりあえず①のデータを取り込んでみます。

image::bigen/exploratory2.gif[]

すると、統計量はたくさん入っているんですが、国や輸出品目名が国コード、品目コード(HSコード)で書いてあって、 何をどこに輸出しているのかさっぱりわかりません。

なので、まずは国名と品目を判明させるために、他のデータもとってきます。

#### 品目名と国名のデータを取り込む
ここがExploratoryのすごいポイントの１つですが、Webの表データのスクレイピングを自動的にやってくれます。 +
操作も超簡単(著作権等には十分配慮してください)。

image::bigen/exploratory3.gif[]

しかし、とってきたデータの中身を見てみると、思ってたような形式になってくれていません。 +
9桁の品目コード(例：010130000)に対応するテーブルが欲しかったのですが、
+
 +
というわけで、自分で作ります。 +
余計な文字(.)を除外し、上6桁のコードで表の間を埋めます。
また、空欄のある行も除外します。+
そして、codeの上6桁と下3桁を結合して表を作ります。 +

image::bigen/exploratory4.gif[]


できました。上図では第３類のデータだけですが、第5類まで同様に作ります。 +
 
国名コードも同様にスクレイピングして取得します。 +
こちらは特に加工が必要なかったので、割愛します。

#### データを合体させる

では、準備が整ったところで、表と表を合体させます。 +

image::bigen/exploratory5.gif[]

合体によって外部からもってきた列は、最後尾に追加されるので、途中で並び替えとかもしてます。  +
 +
さぁ、やっとデータがそろったから時系列で解析するぜ！！！ +
 +
と喜んだのもつかの間、まだ足りませんでした。 +

#### ピボット処理をして時系列分析しやすくする
データをよく見ると、「３月の輸出額」「4月の輸出額」みたいな列が存在しています。 +
時系列でデータを並べようとおもうと、こいつらは行になっていてほしい・・・ +
 +
[options="header"]
|=======================
|月|　輸出額   
|1月    |100
|2月    |200
|3月    |300
|=======================


こんな感じにしたい。 +
なので、やります。 +

image::bigen/exploratory6.gif[]

ピボット処理により、行のデータに変換されました。 +

これにて、データ加工終了です。 + 
 
あとはVizualizerを使って、冒頭のように簡単に色々なグラフを出力できます。


== おわりに
軽い気持ちで「フリーの統計データを使って、適当なグラフ出すぜ！」と思い立ってから、グラフを出せるようになるまで5時間くらいかかりました・・・。 +
データサイエンティストは、グラフを眺める時間が30%で、70%の時間はこういったデータ加工をしているそうです。 +
 +
データは非常に強力で良い意思決定を促しますが、ただ統計的な知識をもって解釈ができればいいわけじゃないことを学びました。 +
 +
また、僕は初心者だったので操作になれておらずかなり時間がかかってしまいましたが、Exploratory超使いやすいし簡単でした。 +
これがなかったらとっくに挫折してそう・・・。 +
 +
次回は機械学習系の話を盛り込んでいこうと思ってます。お楽しみに。